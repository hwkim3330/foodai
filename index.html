<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FoodAI - AI 기반 구내식당 칼로리 관리 서비스">
    <meta name="theme-color" content="#4CAF50">
    <title>FoodAI - AI 칼로리 분석</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Chart.js for statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <!-- 로딩 오버레이 -->
    <div id="loading" class="loading hidden">
        <div class="spinner"></div>
        <p>AI가 분석 중입니다...</p>
    </div>

    <!-- 메인 컨테이너 -->
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <h1 class="logo">🍽️ FoodAI</h1>
            <p class="subtitle">AI 칼로리 분석 서비스</p>
        </header>

        <!-- 네비게이션 탭 -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="home">홈</button>
            <button class="tab-btn" data-tab="analyze">분석</button>
            <button class="tab-btn" data-tab="stats">통계</button>
            <button class="tab-btn" data-tab="settings">설정</button>
        </nav>

        <!-- 홈 탭 -->
        <div id="home-tab" class="tab-content active">
            <!-- 스트릭 & 영양 점수 -->
            <div class="card achievements-card">
                <div class="achievement-header">
                    <div class="streak-box">
                        <div class="streak-icon">🔥</div>
                        <div class="streak-info">
                            <div class="streak-number" id="streak-days">0</div>
                            <div class="streak-label">일 연속</div>
                        </div>
                    </div>
                    <div class="nutrition-score-box">
                        <div class="score-circle" id="nutrition-score-circle">
                            <div class="score-value" id="nutrition-score">0</div>
                        </div>
                        <div class="score-label">주간 영양 점수</div>
                    </div>
                </div>
            </div>

            <!-- 간헐적 단식 타이머 -->
            <div class="card fasting-card" id="fasting-card" style="display:none;">
                <div class="fasting-header">
                    <h2>⏱️ 간헐적 단식</h2>
                    <label class="toggle-switch">
                        <input type="checkbox" id="fasting-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div id="fasting-timer" class="fasting-timer hidden">
                    <div class="fasting-status">
                        <div class="fasting-mode" id="fasting-mode">16:8 모드</div>
                        <div class="fasting-state" id="fasting-state">단식 중</div>
                    </div>
                    <div class="timer-display">
                        <div class="time-value" id="fasting-hours">0</div>
                        <div class="time-label">시간</div>
                        <div class="time-separator">:</div>
                        <div class="time-value" id="fasting-minutes">00</div>
                        <div class="time-label">분</div>
                    </div>
                    <div class="fasting-progress-bar">
                        <div class="fasting-progress-fill" id="fasting-progress"></div>
                    </div>
                    <div class="fasting-actions">
                        <button class="btn btn-secondary" id="end-fasting-btn">중단</button>
                        <button class="btn btn-primary" id="toggle-fasting-btn">식사 시작</button>
                    </div>
                </div>
                <div id="fasting-setup" class="fasting-setup">
                    <select id="fasting-mode-select" class="fasting-mode-select">
                        <option value="16:8">16:8 (16시간 단식)</option>
                        <option value="18:6">18:6 (18시간 단식)</option>
                        <option value="20:4">20:4 (20시간 단식)</option>
                        <option value="14:10">14:10 (14시간 단식)</option>
                    </select>
                    <button class="btn btn-primary" id="start-fasting-btn">단식 시작</button>
                </div>
            </div>

            <!-- 배지 컬렉션 -->
            <div class="card badges-card">
                <h2>🏆 배지 컬렉션</h2>
                <div id="badges-container" class="badges-grid">
                    <p class="empty-message">아직 획득한 배지가 없습니다. 첫 배지를 획득해보세요!</p>
                </div>
            </div>

            <!-- 오늘의 칼로리 -->
            <div class="card">
                <h2>📊 오늘의 칼로리</h2>
                <div class="calorie-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="calorie-progress"></div>
                    </div>
                    <p class="progress-text">
                        <span id="today-calories">0</span> / <span id="target-calories">2000</span> kcal
                    </p>
                    <p class="remaining-text" id="remaining-text">목표까지 2000 kcal 남음</p>
                </div>
            </div>

            <!-- 사진 입력 버튼 -->
            <div class="card">
                <h2>📸 음식 분석하기</h2>
                <div class="analysis-mode-toggle">
                    <label class="mode-option">
                        <input type="radio" name="analysis-mode" value="single" checked>
                        <span>단일 음식</span>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="analysis-mode" value="multiple">
                        <span>메뉴판 스캔</span>
                    </label>
                </div>
                <div class="input-buttons">
                    <button class="btn btn-primary" id="camera-btn">
                        📷 카메라로 촬영
                    </button>
                    <button class="btn btn-secondary" id="gallery-btn">
                        📂 갤러리에서 선택
                    </button>
                </div>
                <input type="file" id="file-input" accept="image/*" capture="environment" hidden>
            </div>

            <!-- AI 추천 메뉴 -->
            <div class="card" id="recommendation-card" style="display:none;">
                <h2>🤖 오늘의 추천 메뉴</h2>
                <div class="recommendation-box">
                    <div class="recommendation-header">
                        <span class="remaining-kcal">남은 칼로리: <strong id="remaining-calories">500</strong> kcal</span>
                    </div>
                    <div id="ai-recommendation" class="ai-recommendation">
                        <div class="recommendation-loading">AI가 맞춤 메뉴를 추천하는 중...</div>
                    </div>
                    <button class="btn btn-primary" id="get-recommendation-btn">
                        ✨ AI 추천 받기
                    </button>
                </div>
            </div>

            <!-- 최근 식사 기록 -->
            <div class="card">
                <h2>🍚 최근 식사 기록</h2>
                <div id="recent-meals" class="meal-list">
                    <p class="empty-message">아직 기록이 없습니다. 첫 식사를 분석해보세요!</p>
                </div>
            </div>
        </div>

        <!-- 분석 탭 -->
        <div id="analyze-tab" class="tab-content">
            <!-- 메뉴 비교 모드 -->
            <div id="menu-comparison" class="card hidden">
                <h2>📋 메뉴 비교</h2>
                <div class="image-preview-container">
                    <div class="image-preview">
                        <img id="menu-image" class="food-image" alt="메뉴판 이미지">
                    </div>
                </div>

                <div id="ai-recommendation-summary" class="ai-recommendation-box"></div>

                <div id="menu-items-grid" class="menu-items-grid"></div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" id="retry-menu-btn">🔄 다시 분석</button>
                </div>
            </div>

            <!-- 단일 음식 분석 모드 -->
            <div id="single-analysis" class="card">
                <h2>🍜 분석 결과</h2>

                <!-- 이미지 미리보기 -->
                <div class="image-preview-container">
                    <div class="image-preview">
                        <img id="food-image" class="food-image" alt="음식 이미지">
                    </div>
                </div>

                <!-- 분석 결과 -->
                <div id="analysis-result" class="analysis-result hidden">
                    <div class="food-name">
                        <input type="text" id="food-name-input" placeholder="음식 이름">
                    </div>

                    <h3>📊 영양 정보</h3>

                    <!-- 영양 그래프 -->
                    <div class="nutrition-charts">
                        <div class="chart-section">
                            <h4>3대 영양소 비율</h4>
                            <div class="macro-chart-container">
                                <canvas id="macro-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-section">
                            <h4>일일 권장량 대비</h4>
                            <div class="daily-chart-container">
                                <canvas id="daily-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="nutrition-grid">
                        <div class="nutrition-item">
                            <label>총 칼로리</label>
                            <input type="number" id="calories-input" placeholder="0"> kcal
                        </div>
                        <div class="nutrition-item">
                            <label>탄수화물</label>
                            <input type="number" id="carbs-input" placeholder="0"> g
                        </div>
                        <div class="nutrition-item">
                            <label>단백질</label>
                            <input type="number" id="protein-input" placeholder="0"> g
                        </div>
                        <div class="nutrition-item">
                            <label>지방</label>
                            <input type="number" id="fat-input" placeholder="0"> g
                        </div>
                        <div class="nutrition-item">
                            <label>나트륨</label>
                            <input type="number" id="sodium-input" placeholder="0"> mg
                        </div>
                    </div>

                    <h3>💡 AI 영양 코치</h3>
                    <div id="ai-advice" class="ai-advice">
                        <div class="advice-loading">AI가 맞춤 조언을 생성하는 중...</div>
                    </div>

                    <h3>🏃 운동량 환산</h3>
                    <div id="exercise-list" class="exercise-list"></div>

                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="retry-btn">🔄 다시 분석</button>
                        <button class="btn btn-primary" id="save-btn">✓ 저장하기</button>
                    </div>
                </div>

                <div id="no-analysis" class="empty-message">
                    분석할 음식 사진을 업로드해주세요.
                </div>
            </div>
            </div>
        </div>

        <!-- 통계 탭 -->
        <div id="stats-tab" class="tab-content">
            <div class="card">
                <h2>📈 칼로리 통계</h2>

                <div class="stats-toggle">
                    <button class="stats-btn active" data-period="daily">일간</button>
                    <button class="stats-btn" data-period="weekly">주간</button>
                    <button class="stats-btn" data-period="monthly">월간</button>
                </div>

                <div class="chart-container">
                    <canvas id="calorie-chart"></canvas>
                </div>

                <div class="stats-summary">
                    <div class="stat-item">
                        <span class="stat-label">평균</span>
                        <span class="stat-value" id="avg-calories">0 kcal</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">최고</span>
                        <span class="stat-value" id="max-calories">0 kcal</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">최저</span>
                        <span class="stat-value" id="min-calories">0 kcal</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>🏆 주요 음식</h2>
                <div id="top-foods" class="top-foods-list"></div>
            </div>
        </div>

        <!-- 설정 탭 -->
        <div id="settings-tab" class="tab-content">
            <div class="card">
                <h2>👤 사용자 정보</h2>
                <div class="form-group">
                    <label>성별</label>
                    <select id="gender-select">
                        <option value="male">남성</option>
                        <option value="female">여성</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>나이</label>
                    <input type="number" id="age-input" placeholder="25" min="10" max="100">
                </div>
                <div class="form-group">
                    <label>신장 (cm)</label>
                    <input type="number" id="height-input" placeholder="170" min="100" max="250">
                </div>
                <div class="form-group">
                    <label>체중 (kg)</label>
                    <input type="number" id="weight-input" placeholder="70" min="30" max="200">
                </div>
                <div class="form-group">
                    <label>활동량</label>
                    <select id="activity-select">
                        <option value="sedentary">거의 운동 안함</option>
                        <option value="light">가벼운 운동 (주 1-3일)</option>
                        <option value="moderate" selected>보통 운동 (주 3-5일)</option>
                        <option value="active">적극적 운동 (주 6-7일)</option>
                        <option value="very-active">매우 적극적 (하루 2회)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h2>🎯 목표 설정</h2>
                <div class="form-group">
                    <label>목표</label>
                    <select id="goal-select">
                        <option value="lose">체중 감량 (-500 kcal/일)</option>
                        <option value="maintain" selected>체중 유지</option>
                        <option value="gain">체중 증가 (+500 kcal/일)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>목표 칼로리 (kcal)</label>
                    <input type="number" id="target-calories-input" placeholder="2000" min="1000" max="5000">
                </div>
                <button class="btn btn-primary" id="save-settings-btn">설정 저장</button>
            </div>

            <div class="card">
                <h2>🔑 Gemini API 키</h2>
                <div class="form-group">
                    <label>API 키 <span class="api-status" id="api-status"></span></label>
                    <input type="password" id="api-key-input" placeholder="AIzaSy...">
                    <button class="btn btn-secondary" id="toggle-api-key">표시/숨김</button>
                </div>
                <button class="btn btn-primary" id="save-api-key-btn">API 키 저장</button>
                <div class="info-box">
                    <p><strong>API 키 발급 방법:</strong></p>
                    <ol>
                        <li><a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> 접속</li>
                        <li>'Create API Key' 버튼 클릭</li>
                        <li>생성된 키를 복사하여 위에 입력</li>
                    </ol>
                    <p class="note">⚠️ API 키는 로컬스토리지에 안전하게 저장됩니다.</p>
                </div>
            </div>

            <div class="card">
                <h2>🗑️ 데이터 관리</h2>
                <div class="data-info">
                    <p>저장된 식사: <strong id="meal-count">0</strong>건</p>
                    <p>사용 중인 저장소: <strong id="storage-size">0</strong> KB</p>
                </div>
                <button class="btn btn-secondary" id="export-data-btn">데이터 내보내기</button>
                <button class="btn btn-danger" id="clear-data-btn">전체 데이터 삭제</button>
            </div>
        </div>
    </div>

    <!-- 푸터 -->
    <footer class="footer">
        <p>Made with ❤️ for 2025 SeSAC Hackathon</p>
        <p><a href="https://github.com/hwkim3330/foodai" target="_blank">GitHub</a></p>
    </footer>

    <!-- Toast 알림 -->
    <div id="toast" class="toast"></div>

    <!-- JavaScript 모듈 -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
